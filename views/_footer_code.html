<% if(env === 'production') { %>
  <script type="text/javascript" src="js/app.min.js"></script>
<% } else { %>
  <script type="text/javascript" src="models/complaint.js"></script>
  <script type="text/javascript" src="collections/complaints.js"></script>
  <script type="text/javascript" src="views/point.js"></script>
  <script type="text/javascript" src="views/control.js"></script>
  <script type="text/javascript" src="app.js"></script>
<% } %>
<script type="text/template" id="control-template">
  <div class="controls">
    <form>
      <select>
        <option>White</option>
        <option>Black</option>
      </selection>
    </form>
  </div>
</script>
<script type="text/template" id="tooltip-template">
  <table>
    <tr>
      <th>Type:</th>
      <td>{{ type }}</td>
    </tr>
    <tr>
      <th>Unit:</th>
      <td>{{ unit }}</td>
    </tr>
    <tr>
      <th>Race:</th>
      <td>{{ race }}</td>
    </tr>
    <tr>
      <th>Age:</th>
      <td>{{ age }}</td>
    </tr>
    <tr>
      <th>Sex:</th>
      <td>{{ sex }}</td>
    </tr>
    <tr>
      <th>Action:</th>
      <td>{{ action }}</td>
    </tr>
    <tr>
      <th>Status:</th>
      <td>{{ status }}</td>
    </tr>
  </table>
</script>
<script type="text/javascript">
  $(document).ready(function () {
     _.templateSettings = {
      interpolate : /\{\{(.+?)\}\}/g
    };

    app.opts = {
      mapContainer: 'map',
      tileURL: 'http://api.tiles.mapbox.com/v3/mdb.map-iis6te5b.jsonp',
      mapOptions: {
        center: [39.99, -75.150],
        zoom: 12,
        minZoom: 9,
        maxZoom: 18,
        maxBounds: [
          [39.69, -76.20],
          [40.60, -74.14]
        ]
      }
    };
    app.dispatcher = _.clone(Backbone.Events);
    app.control = new app.Control({
      el: '#controls'
    });

    //app.control.render();

    Tabletop.init({
      key: '0Aii0ITjxvJ6fdFlPNHVINHY2dVhfODNsY2JWU0U0NHc',
      callback: function(data, tabletop) { 
        var i,
            template = _.template($('#tooltip-template').html());
          
        app.complaints = new app.Complaints(data);
        app.initMap(function() {
          app.complaints.each(function (complaint) {
            var point = new app.Point({model: complaint});
            point.render();
          });
        });         
      },
      simpleSheet: true 
    });
  });
</script>
